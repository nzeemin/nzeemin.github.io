<!doctype html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Портирование Stop the Express - nzeemin.github.io</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="text/javascript" src="//vk.com/js/api/openapi.js?151"></script>
    <script type="text/javascript">VK.init({apiId: 6328196, onlyWidgets: true});</script>
</head>
<body>

    <header>
        <a class="header-brand" href="/">nzeemin.github.io</a> /
        Портирование Stop the Express
    </header>

    <table class="main-table" cellpadding="0" cellspacing="0">
        <tbody>
            <tr>
                <td id="navbar" width="300">
                    <div class="box">
                        <h2>Содержание</h2>
                        <ul class="contents">
                            <li>Оригинал на ZX Spectrum</li>
                            <li>Stop the Express на Электроника МС 0515</li>
                            <li>Портирование на УКНЦ</li>
                        </ul>
                    </div>
                </td><!--navbar end-->

                <td>
                    <div class="box">
                        <h2>Оригинал на ZX Spectrum</h2>
                        <div class="entry">
                            <p>
                                <a href="http://www.worldofspectrum.org/infoseekid.cgi?id=0004916">"Stop the Express" на World of Spectrum</a>
                            </p>
                        </div>
                    </div>

                    <div class="box">
                        <h2>Stop the Express на Электроника МС 0515</h2>
                        <div class="entry">
                            <p>
                                В начале 1990-х во Львове на компьютер &laquo;Электроника МС 0515&raquo; был портирован ряд программ с компьютера
                                ZX Spectrum, в частности, игра &laquo;Stop the Express&raquo;.
                                &laquo;Электроника МС 0515&raquo; имеет организацию экрана, сходную с экраном ZX Spectrum, но совершенно другой
                                процессор &ndash; 16-разрядный, с системой команд PDP-11.
                                Поэтому такое портирование скорее представляло собой полное дизассемблирование и по-командное переписывание кода игры.
                            </p>
                            <p>
                                Как игра устроена внутри.<br/>
                                Игровой экран имеет размер 32&times;24 тайла, тайлы 8x8 пикселей плюс атрибут. Т.е. экран 256&times;192 = экран Спектрума.
                                В памяти мы храним экран в виде индексов тайлов два раза, я их назвал &laquo;экран план&raquo; и &laquo;экран факт&raquo;.
                                Если мы хотим что-то вывести на экран &ndash; меняем всегда только экран план. Допустим хотим вывести строку &ndash;
                                просто копируем символы этой строки на экран план.
                                Регулярно выполняется процедура актуализации экрана. Она бежит по экрану план, для каждого тайла сравнивает
                                есть ли различие с тайлом экран факт.
                                Только если различие есть, то делаем изменение на экране, и обновляем номер тайла в экране факт.
                                Сами тайлы это 9 байт &ndash; 8 байт на пиксели плюс один байт на атрубут, всего 256 тайлов.
                                Если обратите внимание, большинство строк на экране в горизонтальном направлении почти одинаковы.
                                Поэтому даже когда выполняется вроде бы большое скроллирование (поезд уезжает), реально изменений на экране не так уж и много.
                            </p>
                            <ul>
                                <li>
                                    <a href="https://github.com/nzeemin/uknc-stopexpress/blob/master/original/expres.lst">expres.lst</a>
                                    &ndash; восстановленный комментированный код игры
                                </li>
                            </ul>
                            <p>
                                Скриншот экрана &laquo;Электроника МС 0515&raquo; &ndash; до пиксела совпадает с версией для ZX Spectrum:
                            </p>
                            <img src="https://github.com/nzeemin/uknc-stopexpress/raw/master/screenshot/original-ms0515.png" alt="" style="max-width:100%;">
                        </div>
                    </div>

                    <div class="box">
                        <h2>Портирование на УКНЦ</h2>
                        <div class="entry">
                            <ul>
                                <li><a href="https://github.com/nzeemin/uknc-stopexpress">github.com/nzeemin/uknc-stopexpress</a> &ndash; репозиторий кода</li>
                            </ul>
                            <p>
                                Скриншоты портированой версии:<br />
                                <img src="https://github.com/nzeemin/uknc-stopexpress/raw/master/screenshot/demoscreen.png" alt="" style="max-width:100%;">
                                <br />
                                <img src="https://github.com/nzeemin/uknc-stopexpress/raw/master/screenshot/demoscreen2.png" alt="" style="max-width:100%;">
                            </p>
                            <p>
                                Демо-режим:<br />
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/66ETuJ9uO6s" frameborder="0" allowfullscreen></iframe>
                            </p>
                            <p>
                                На реальном УКНЦ (спасибо hobot с форума zx-pk.ru):<br />
                                <iframe width="560" height="315" src="https://www.youtube.com/embed/sc0jTqVKd_8" frameborder="0" allowfullscreen></iframe>
                            </p>
                        </div>
                    </div>

                    <div class="box">
                        <div id="vk_comments"></div>
                        <script type="text/javascript">VK.Widgets.Comments("vk_comments", {limit: 10, attach: "*"});</script>
                    </div>

                </td>
            </tr>
        </tbody>
    </table>

</body>
