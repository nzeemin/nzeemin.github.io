<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Сталкер/Зона/Пикник - nzeemin.github.io</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- Yandex.RTB -->
    <script>window.yaContextCb = window.yaContextCb || []</script>
    <script src="https://yandex.ru/ads/system/context.js" async></script>
</head>
<body>
<script src="js/contents.js"></script>

<header>
    <a class="header-brand" href="/">nzeemin.github.io</a> /
    Сталкер/Зона/Пикник
</header>

<div id="main-container">
    <aside id="navbar">
        <div class="box box-nobox">
            <h2>Сталкер/Зона/Пикник</h2>
        </div>

        <div class="box">
            <h2>Содержание</h2>
            <ul class="contents">
            </ul>
        </div>

        <div class="box" style="margin-top: 20px; min-height: 150px">
            <h2 style="background: sandybrown">Реклама</h2>
            <!-- Yandex.RTB R-A-4409681-2 -->
            <div id="yandex_rtb_R-A-4409681-2"></div>
            <script>
                window.yaContextCb.push(() => {
                    Ya.Context.AdvManager.render({"blockId": "R-A-4409681-2", "renderTo": "yandex_rtb_R-A-4409681-2"})
                })
            </script>
        </div>
    </aside><!--navbar end-->

    <div id="main">
        <div class="box">
            <h2>Оригинальная игра</h2>
            <div class="entry">
                <p>
                    <a href="/ukncbtl-wasm/index.html?state=/ukncbtl/stalk.uknc.zip&run=1" target="_blank"
                       class="bigbluebutton"
                    >Запустить в онлайн-эмуляторе UKNCBTL</a>
                </p>
                <p>
                    Это игра в жанре &laquo;рогалик&raquo; (Rogue-like), бродилка по подземельям,
                    по мотивам повести Стругацких &laquo;Пикник на обочине&raquo;.
                    Игра называлась &laquo;Зона&raquo;, &laquo;Сталкер&raquo; или &laquo;Пикник&raquo; &ndash;
                    файл игры назывался STALK.SAV, PIKNIK.SAV или ZONA.SAV,
                    и предназначался для советских PDP11-совместимых машин &ndash; таких как ДВК и УКНЦ.
                </p>
                <p>
                    По-видимому, игра создана в конце 1980-х, автор &ndash; программист из Ульяновска &ndash;
                    первоначально программа выводила копирайт:<br/>
                    <code>*** (С)УЛЬЯНОВСК УЛПИ "ГОЛОГРАФИЯ"***</code>
                </p>
                <p>
                    В январе 2024 года Юрий Финкель <a href="https://vk.com/yury_finkel?w=wall372147848_2190" target="_blank">написал в ВК</a>:
                </p>
                <blockquote>
                    <p>Эта игра была написана в конце 80-х моим знакомым Сергеем Вершининым (мы работали в той самой лаборатории "Голография", упомянутой в тексте, я фактически присутствовал при её создании :) ). Тут на меня вышли с вопросом, как же всё-таки звали автора, я его сдал :), люди с ним уже связались. Заодно поиграл в эту веб-версию, вспомнил молодость. Хотя лет 5 назад я в неё тоже играл, тогда я нашёл эмулятор PDP-11 для Windows, а также образ диска с играми. Но я не знал тогда, что люди фанатеют именно с этой игры настолько, что аж декомпилировали и восстановили текст на Паскале, а затем и переписали на Javascript.</p>
                    <p>Кстати, несколько сообщений игры явно были заменены двоичным редактором. Я точно помню, что в исходной версии упоминался журнал "Уайрлесс Уорлд" (именно в таком написании), но, видимо, шутка была слишком локальная (у нас в лаборатории была подшивка этого англоязычного журнала "Wireless World"), поэтому кто-то позднее заменил на журнал "Акушерство и гинекология". Да и насчёт "отрезанной головы предыдущего Сталкера" кажется мне, что в оригинале было что-то вроде "останков предыдущего путешественника", хотя тут могу ошибаться.</p>
                </blockquote>
                <p>
                    На основе оригинала было создано множество вариаций игры, чаще всего они различались только
                    выводимыми сообщениями
                    &ndash; файл игры редактировался бинарным редактором DESS, логика игры, по-видимому, оставалась
                    почти неизменной.
                </p>
                <ul>
                    <li><a href="https://zx-pk.ru/threads/29331-igra-quot-zona-quot-na-dvk.html" target="_blank">Обсуждение
                        игры на форуме zx-pk.ru</a></li>
                    <li><a href="https://youtu.be/0y7RggMs_Ro" target="_blank">Видео игры, работающей под эмулятором
                        MAME</a></li>
                </ul>
            </div>
        </div>

        <div class="box">
            <h2>Дизасм в MACRO-11</h2>
            <div class="entry">
                <p>
                    За пару недель я получил дизассемблированный исходник игры на MACRO-11, который при компиляции
                    давал исполнимый файл, совпадающий до байта с оригиналом.
                    С самого начала было понятно, что оригинал написан на Паскале ДВК (судя по блоку сообщений Паскаля).
                    Я определил начало паскалевских процедур/функций, отделил данные от кода, определил назначение
                    части переменных игры.
                    Эта работа была проделана с середины марта по начало апреля 2021 года.
                </p>
            </div>
        </div>

        <div class="box">
            <h2>Восстановление кода на Паскале</h2>
            <div class="entry">
                <p>
                    Используя код на MACRO-11 как основу, я стал восстанавливать код на Паскале ДВК
                    (этот вариант Паскаля основан на OMSI Pascal).
                    В результате компиляции с Паскаля, получается файл на MACRO-11, который затем компилируется и
                    линкуется обычными средствами RT-11 &ndash; через MACRO и LINK.
                </p>
                <p>
                    Я продолжал комментировать код игры на ассемблере, выделял в нём паттерны паскалевских конструкций,
                    и параллельно выписывал исходник на Паскале, компилируя и проверяя, что код получается именно
                    таким, как в бинарнике игры.
                    В целом конечно это была довольно большая работа, в которой мне сильно помогли участники форума
                    zx-pk.ru,
                    особенно Алексей Кислый (Alex_K).
                    Мы узнали для себя много нового об этом варианте Паскаля, в том числе вещи, выходящие за стандартную
                    документацию &ndash; например, использование конструкции GOTO.
                </p>
                <p>
                    В итоге мне удалось получить исходный код на Паскале ДВК, полностью &laquo;идентичный натуральному&raquo;,
                    но для этого пришлось ещё написать отдельную программу-&laquo;патчер&raquo; строк на C#.
                    Дело в том, что использованный мной бинарный файл &laquo;оригинала&raquo; игры был сильно изменён
                    &ndash; строки были переведены в 8-битную кодировку КОИ-8. Но Паскаль ДВК может работать только
                    с 7-битной кодировкой КОИ-7. Поэтому, я компилировал паскалевский код в .MAC-файл, который затем
                    патчил, и уже патченный файл проходил дальнейшую компиляцию.
                </p>
                <p>
                    В конце концов, бинарник, получаемый мной при компиляции с Паскаля, стал отличатся от &laquo;оригинала&raquo;
                    всего на один байт в заголовке файла, что в общем доказывало, что паскалевский исходник полностью
                    соответствует тому, что было в оригинале. Эту работу я завершил 17 апреля 2021 года.
                </p>
                <ul>
                    <li><a href="https://github.com/nzeemin/uknc-various/blob/master/STALK-PASCAL/STALK1.PAS"
                           target="_blank">STALK1.PAS &ndash; восстановленный исходник игры на Паскале</a></li>
                    <li><a href="http://sandro.pdp-11.ru/misc/stalker/stalk_literate.pas" target="_blank">Исходник на
                        Паскале с осмысленными названиями переменных и комментариями от Александра Тишина (Sandro)</a>
                    </li>
                    <li>
                        <a href="https://github.com/sergev/vak-opensource/blob/master/languages/pascal/game-stalker/stalk1.pas"
                           target="_blank">Исходник, адаптированный для Free Pascal Compiler, от Сергея Вакуленко</a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="box">
            <h2>Веб-версия игры на HTML/JavaScript</h2>
            <div class="entry">
                <p>
                    <a href="/stalk/stalk.html" target="_blank" class="bigbluebutton"
                    >Запустить веб-версию STALK</a>
                </p>
                <p>
                </p>
            </div>
        </div>

    </div><!-- main -->
</div><!-- container -->

<script>
    generateTableOfContents();
</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9B3N2FNN5F"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', 'G-9B3N2FNN5F');
</script>

</body>
</html>
